<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>QR-Code f端r Lagerbestandsseite</title>
    <link rel="stylesheet" href="../../Startseite/Startseite.css">
   
  </head>
  <body>
    <div class="app-container">
      <!-- Firmenlogo -->
      <div class="logo_aktuell">
        <img src="../../Logo/logo_aktuell.png" alt="logo" />
      </div>
      <h1>Login</h1>
      <h2>L A G E R - L O G I S T I K</h2>

      <!-- QR Code Bereich -->
      <div class="qr-code">
        <h3>QR Code f端r Lagerbestandsseite</h3>
        <div id="qrcode"></div>
        <p id="timestamp"></p>
        <button id="regenButton">Jetzt QR-Code neu generieren</button>
      </div>

      <!-- Login-Formular -->
      <form id="login-form" onsubmit="return handleLogin(event)">
        <label for="personalnummer">Personalnummer:</label>
        <input type="text" id="personalnummer" name="personalnummer" required />

        <label for="login-password">Neues Passwort:</label>
        <input type="password" id="login-password" name="login-password" required />

        <input type="submit" value="Login" />
      </form>
      <a href="#">Passwort vergessen?</a>
    </div>

    <!-- Verlinkung des eigenen JavaScript-Codes -->
    <script src="Loginseite_Lager.js"></script>

    <!-- Einbindung der QR-Code-Bibliothek -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/davidshimjs/qrcodejs/qrcode.min.js"></script>

    <script>
      // QR-Code f端r Lagerbestandsseite generieren
      const generateQRCode = () => {
        const qrCodeContainer = document.getElementById("qrcode");
        const lagerBestandsURL = "https://example.com/lagerbestand"; // URL zur Lagerbestandsseite

        qrCodeContainer.innerHTML = ""; // Entferne alten QR-Code
        new QRCode(qrCodeContainer, {
          text: lagerBestandsURL,
          width: 200,
          height: 200,
        });

        const timestamp = new Date();
        updateTimestamp(timestamp);
      };

      // Aktualisiere die Anzeige der Zeit
      const updateTimestamp = (timestamp) => {
        const formattedTime = timestamp.toLocaleTimeString("de-DE", {
          hour: "2-digit",
          minute: "2-digit",
          second: "2-digit",
        });
        document.getElementById("timestamp").textContent = `Letzte Generierung: ${formattedTime}`;
      };

      // Timer, um alle 2 Stunden den QR-Code neu zu generieren
      const startQRCodeTimer = () => {
        generateQRCode(); // Initialer QR-Code
        setInterval(generateQRCode, 2 * 60 * 60 * 1000); // Alle 2 Stunden
      };

      // Manuelles Neu-Generieren durch Button
      document.getElementById("regenButton").addEventListener("click", () => {
        generateQRCode();
      });

      // Initialisieren
      window.onload = startQRCodeTimer;

      // Funktion zur Handhabung des Login-Formulars
      function handleLogin(event) {
        event.preventDefault();

        const enteredPersonalnummer = document.getElementById("personalnummer").value;
        const enteredPassword = document.getElementById("login-password").value;

        // Abrufen der gespeicherten Personalnummer und Passwort aus localStorage
        const storedPersonalnummer = localStorage.getItem("personalnummer");
        const storedPassword = localStorage.getItem("loginPassword");

        if (
          enteredPersonalnummer === storedPersonalnummer &&
          enteredPassword === storedPassword
        ) {
          alert("Login erfolgreich! Willkommen zur Sicherheitsapp.");
          window.location.href = "../Lagerbestand.html"; // Weiterleitung zur Startseite
        } else {
          alert("Ung端ltige Anmeldedaten. Bitte versuchen Sie es erneut.");
        }
      }
    </script>
  </body>
</html>
